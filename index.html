<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador PWA de C√≥cteles</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#06b6d4" />

  <style>
    /* Estilos b√°sicos garantizados sin conexi√≥n */
    #offlineModal {
      display: none;
      position: fixed;
      inset: 0;
      background: #0f172a;
      color: white;
      z-index: 9999;
      text-align: center;
      font-family: sans-serif;
      padding: 2rem;
    }
    #offlineModal.visible {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #offlineModal h2 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    /* Banner de reconexi√≥n */
    #onlineBanner {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #10b981;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-family: sans-serif;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      animation: fadeInOut 3s ease;
      z-index: 9999;
    }

    @keyframes fadeInOut {
      0% {opacity: 0; transform: translate(-50%, 20px);}
      10%, 90% {opacity: 1; transform: translate(-50%, 0);}
      100% {opacity: 0; transform: translate(-50%, 20px);}
    }
  </style>
</head>

<body>
  <header>
    <h1>üçπ Buscador de C√≥cteles PWA</h1>
  </header>

  <main>
    <section class="search-box">
      <input type="text" id="cocktailName" placeholder="Escribe el nombre del c√≥ctel" />
      <button id="searchButton">Buscar</button>
    </section>

    <section id="result" class="result-container">
      <p>Escribe un nombre de c√≥ctel y presiona buscar para iniciar la prueba.</p>
    </section>
  </main>

  <!-- Modal sin conexi√≥n -->
  <div id="offlineModal">
    <h2>üö´ Sin conexi√≥n</h2>
    <p>No tienes acceso a Internet. Algunas funciones pueden no estar disponibles.</p>
  </div>

  <!-- Banner de reconexi√≥n -->
  <div id="onlineBanner">‚úÖ Conexi√≥n restablecida</div>

  <script src="main.js"></script>
  <script src="scripts/app.js"></script>

  <script>
    const offlineModal = document.getElementById('offlineModal');
    const onlineBanner = document.getElementById('onlineBanner');

    // Mostrar modal solo si inicia sin conexi√≥n
    window.addEventListener('load', () => {
      if (!navigator.onLine) {
        offlineModal.classList.add('visible');
      }
    });

    // Cuando se pierde la conexi√≥n
    window.addEventListener('offline', () => {
      offlineModal.classList.add('visible');
    });

    // Cuando se recupera la conexi√≥n
    window.addEventListener('online', async () => {
      if (offlineModal.classList.contains('visible')) {
        offlineModal.classList.remove('visible');
      }

      // Mostrar banner animado
      onlineBanner.style.display = 'block';
      setTimeout(() => {
        onlineBanner.style.display = 'none';
      }, 3000);

      // Esperar 2s y luego refrescar controladamente
      setTimeout(async () => {
        // Borrar cach√© viejo y recargar con datos frescos
        if ('caches' in window) {
          const keys = await caches.keys();
          await Promise.all(keys.map(key => caches.delete(key)));
        }
        location.reload();
      }, 2000);
    });

    // Registrar Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('‚úÖ SW registrado correctamente', reg))
          .catch(err => console.error('‚ùå Error en SW:', err));
      });
    }
  </script>
</body>
</html>
